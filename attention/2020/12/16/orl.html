<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Paper Notes: Offline Reinforcement Learning | Shivam Shakti</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="Paper Notes: Offline Reinforcement Learning" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Landscape of Open Problems in Offline RL" />
<meta property="og:description" content="Landscape of Open Problems in Offline RL" />
<link rel="canonical" href="https://shakti.dev/attention/2020/12/16/orl.html" />
<meta property="og:url" content="https://shakti.dev/attention/2020/12/16/orl.html" />
<meta property="og:site_name" content="Shivam Shakti" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-16T00:00:00-06:00" />
<script type="application/ld+json">
{"url":"https://shakti.dev/attention/2020/12/16/orl.html","headline":"Paper Notes: Offline Reinforcement Learning","datePublished":"2020-12-16T00:00:00-06:00","dateModified":"2020-12-16T00:00:00-06:00","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://shakti.dev/attention/2020/12/16/orl.html"},"description":"Landscape of Open Problems in Offline RL","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://shakti.dev/feed.xml" title="Shivam Shakti" /><!-- the google_analytics_id gets auto inserted from the config file -->



<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','//www.google-analytics.com/analytics.js','ga');ga('create','UA-165330056-1','auto');ga('require','displayfeatures');ga('send','pageview');</script>

<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Shivam Shakti</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About Me</a><a class="page-link" href="/projects/">Projects</a><a class="page-link" href="/research/">Research</a><a class="page-link" href="/search/">Search</a><a class="page-link" href="/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Paper Notes: Offline Reinforcement Learning</h1><p class="page-description">Landscape of Open Problems in Offline RL</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-12-16T00:00:00-06:00" itemprop="datePublished">
        Dec 16, 2020
      </time>
       â€¢ <span class="read-time" title="Estimated read time">
    
    
      3 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/categories/#attention">attention</a>
        
      
      </p>
    

    </header>

  <div class="post-content e-content" itemprop="articleBody">
    <h2 id="challenges-of-offline-rl">Challenges of Offline RL</h2>

<ul>
  <li>
    <p>There is no possibility of improving the policy using exploration, so it may be impossible to discover better policy if the dataset does not contain transitions with high-reward regions of the state space. - This problem cannot be solved, so it out of scope.</p>
  </li>
  <li>
    <p>Unlike supervised learning, where train and test distribution are assumed to be the same, the whole point of Offline RL is to learn a policy that does something differently from the logged dataset. - This is the problem of <strong>distributional shift</strong>.</p>
  </li>
</ul>

<h2 id="offline-evaluation-and-reinforcement-learning-via-importance-sampling">Offline Evaluation and Reinforcement Learning via Importance Sampling</h2>

<p><img src="/images/posts/orl/offline-rl-importance-sampling.jpg" alt="importance sampling papers" /></p>

<h3 id="offline-evaluation-via-importance-sampling">Offline Evaluation via Importance Sampling</h3>

<ul>
  <li>Importance Sampling gives an unbiased estimate of the policy performance but it can have high variance due to the product of importance weights in case of RL.</li>
  <li>Doubly Robust estimator for policy evaluation help reduce this variance by using an approximation of the Q-values in the estimate while still having an unbiased estimate.</li>
  <li>High Confidence OPE approaches provide a lower confidence bound on the expected return of policy in safety-critical scenarios.</li>
</ul>

<h3 id="off-policy-policy-gradient">Off-Policy Policy Gradient</h3>

<ul>
  <li>Importance Sampling can be used to convert online policy gradient to off-policy gradient algorithms like weighted importance sampling policy gradient estimator.</li>
  <li>Doubly Robust estimators for policy gradient can also be derived from the same by using a baseline for advantage estimates but unfortunately they suffer from high variance to be effective.</li>
  <li>Multiplication of per-action importance weights over the time steps lead to high variance.</li>
  <li>Off-policy algorithms can employ regularization to the learned policy such that it does not deviate far from the behaviour policy. The regularizations can be in form of softmax over importance weights or KL-divergence.</li>
</ul>

<h3 id="approximate-off-policy-gradients">Approximate Off-Policy Gradients</h3>

<ul>
  <li>Approximate importance-sampled gradient can be derived by using the state distribution if the behaviour policy in place of the current policy.</li>
  <li>Although this is a biased estimator of the gradient, it removes the need for importance sampling thereby making it practical.</li>
  <li>This forms the basis of several off-policy actor-critic approaches like DDPG.</li>
  <li>Further improvements can be obtained by introducing control variates and clippingimportance weights to control variance.</li>
</ul>

<h3 id="marginalized-importance-sampling">Marginalized Importance Sampling</h3>

<ul>
  <li>Another way to avoid bias from off-policy state distribution and variance from per-action importance weighting is the we directly estimate the state-marginal importance ration.</li>
  <li>Calculating the exact ratio is intractable (why?) but methods of estimating marginalized importance ration has been introduced.</li>
  <li>Forward Bellman equation based approaches
    <ul>
      <li>Temporal difference updates can be used to estimate the state-marginal importance ratio under the policy by using tricks like soft-normalization and discounted evaluation.</li>
      <li>Variational power method approach to combine function approximation and power iteration to estimate the state-marginal importance ration has also been studied recently. Similar methods can also be used in off-policy actor critic methods.</li>
      <li>Solving an adversarial, saddle-point optimization is also proposed to obtain the state-marginal importance ratio.</li>
      <li>Approaches applying divergence metric to solve a modified forward bellman equation and constraining the importance ratio to prevent degenerate solutions have also been proposed.</li>
    </ul>
  </li>
  <li>Backward Bellman equation approached via convex duality
    <ul>
      <li>Application of convex optimization techniques to policy optimization in off-policy setting. Extending these results to practical deep RL settings has proven challenging.</li>
      <li>Devise a convex optimization problem with state-marginal importance ratio as its optimal solution.</li>
      <li>Use of f-divergence as a regularizer between state-action marginal of the learned policy and state-action marginal of the dataset is proposed as an extension of the convex optimization problem.</li>
    </ul>
  </li>
</ul>

<h3 id="challenges-and-open-problems">Challenges and Open Problems</h3>

<ul>
  <li>When behaviour policy is too different from the learned policy, the importance weights will become degenerate and estimate of return will have too much variance. Maximum improvement via importance sampling is limited by:
    <ul>
      <li>suboptimality of behaviour policy</li>
      <li>dimensionality of state and action space</li>
      <li>effective horizon of task</li>
    </ul>
  </li>
  <li>Most effective off-policy policy gradient methods require estimating value function or state-marginal importance ratio using dynamic programming. Dynamic programming methods suffer from issues pertaining to out-of-distribution queries in offline setting, making it hard to stably learn the value function without additional corrections.</li>
</ul>


  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="shakti365/scaling-pancake"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/attention/2020/12/16/orl.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>A window to my personal musings.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/shakti365" target="_blank" title="shakti365"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg></a></li><li><a rel="me" href="https://twitter.com/shakti0802" target="_blank" title="shakti0802"><svg class="svg-icon grey"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
